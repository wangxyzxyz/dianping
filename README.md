# dianping

## 1. 项目介绍

本项目是一个商铺点评网站。网站主要功能是支持用户对商铺进行点评，以及查看其他用户的点评信息，帮助用户对商铺质量进行评估。同时，通过发放大额优惠券的方式为商铺宣传引流。主要实现功能包括：基于短信验证码的登录，商铺信息管理，优惠券秒杀，商铺点评的上传与查看，点赞，好友关注以及已关注用户的点评笔记推送。



## 2. 主要后端技术

| 技术         | 说明     |
| ---------- | ------ |
| Java       | 开发语言   |
| SpringBoot | 开发框架   |
| MySQL      | 关系型数据库 |
| Redis      | 内存数据库  |
| RabbitMQ   | 消息中间件  |

## 3. 功能介绍

（扩展功能基于作者的思考对项目的完善）

### 登录模块

基础功能：基于验证码进行校验登录。在 redis 中保存 token 和用户信息，解决服务器集群下的 session 共享问题。在拦截器中实现刷新 token 有效期的功能，同时拦截未登录用户，将用户信息存入 ThreadLocal，封装线程隔离的对象。

**扩展功能：接入阿里云短信服务，完善验证码下发。基于 redis 的 zest 数据结构和时间窗口思想，控制验证码的发送频率。**

### 商铺信息管理模块

基础功能：将商铺信息加载到 redis 缓存，提高响应速度。

**扩展功能：在更新数据库时，使用消息队列保证缓存删除成功，保证缓存的最终一致性。基于布隆过滤器解决缓存穿透问题。基于 redisson 互斥锁与逻辑过期解决缓存击穿问题。**

### 优惠券秒杀模块

基础功能：单服务器情况下，基于乐观锁与同步机制解决库存超卖问题与保证一人一单功能实现。

**扩展功能：在高并发情况下的一系列性能优化。基于 redis 的库存预减以及一人一单判断，在库存为空时添加内存标记，避免再访问 redis，使用令牌桶算法进行限流，使用 RabbitMQ 分化业务流程，实现异步下单。在测试代码中生成用于压测的大量用户数据，使用JMeter 进行压测。**

**基于美团 Leaf 实现订单全局唯一id生成，基于 Websocket 实现订单结果推送，基于RabbitMQ 延迟消息实现订单超时未支付检查。**

### 评价笔记模块

基础功能：上传评价笔记，点赞笔记，关注其他用户，在动态页面，可以查看已关注用户的按时间发布的点评笔记。
